<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XXX GIT</title>

    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --neon-pink: #a020f0; 
            --neon-purple: #8a2be2; 
            --dark-bg: #0d0a1b; 
            --darker-bg: #080610; 
            --card-bg: #151125; 
            --text: #ffffff;
            --text-secondary: #c0c3d5; 
            --warning: #ff5722;
        }

        body {
            background: linear-gradient(135deg, var(--darker-bg), var(--dark-bg));
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        header {
            background: rgba(8, 6, 16, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.2rem 5%;
            display: flex;
            flex-direction: column; 
            gap: 1rem; 
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
        }

        .header-top-row { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%; 
        }

        .logo {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text);
            text-decoration: none;
            text-shadow:
                0 0 15px var(--neon-pink),
                0 0 30px var(--neon-purple),
                0 0 45px rgba(138, 43, 226, 0.8),
                0 0 60px rgba(160, 32, 240, 0.6);
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo i {
            color: var(--neon-pink);
            font-size: 2.5rem;
            text-shadow: 0 0 10px var(--neon-pink);
        }

        .warning-badge {
            background-color: red;
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
            vertical-align: super;
        }

        .header-right { 
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            width: 100%; 
            justify-content: flex-end; 
        }

        .search-input {
            background: var(--card-bg);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 20px;
            padding: 0.7rem 1.2rem;
            padding-right: 2.8rem;
            color: var(--text);
            font-size: 1rem;
            width: 0; 
            opacity: 0;
            visibility: hidden;
            transition: width 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            box-shadow: 0 0 10px rgba(160, 32, 240, 0.2);
        }

        .search-input.active {
            width: calc(100% - 40px); 
            opacity: 1;
            visibility: visible;
        }

        .search-btn {
            background: transparent;
            border: none;
            color: var(--text);
            cursor: pointer;
            font-size: 1.4rem;
            transition: all 0.3s;
            position: absolute;
            right: 10px;
            z-index: 1;
        }

        .search-btn:hover {
            color: var(--neon-pink);
            transform: scale(1.1);
        }

        .search-input.active + .search-btn {
            color: var(--neon-pink);
        }

        .profile-container {
            position: relative;
        }

        .profile-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }

        .profile-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--neon-pink);
        }

        .profile-btn img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            display: none;
        }

        .dropdown {
            position: absolute;
            top: 55px;
            right: 0;
            background: var(--card-bg);
            border-radius: 8px;
            width: 220px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 10;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.95rem;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: rgba(138, 43, 226, 0.1);
        }

        .dropdown-item i {
            width: 24px;
            text-align: center;
            color: var(--neon-pink);
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            padding: 1.5rem 5%;
            background: rgba(8, 6, 16, 0.7);
            border-bottom: 1px solid rgba(138, 43, 226, 0.1);
        }

        .tab {
            flex-grow: 1;
            padding: 0.8rem 1rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab i {
            font-size: 1.1rem;
            color: var(--text-secondary);
            transition: color 0.3s;
        }

        .tab.active, .tab:hover {
            color: var(--text);
            background: rgba(138, 43, 226, 0.15);
        }

        .tab.active i, .tab:hover i {
            color: var(--neon-pink);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--neon-pink);
            border-radius: 10px;
            box-shadow: 0 0 10px var(--neon-pink);
        }

        .categories-section {
            padding: 3rem 5%;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            margin-top: -30px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, var(--neon-pink), transparent);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.5rem;
        }

        .category-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            border: 1px solid rgba(138, 43, 226, 0.1);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            width: 100%;
            padding-top: 50%; 
            position: relative; 
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 0 2px var(--neon-pink);
        }

        .category-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; 
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .category-card:hover .category-image {
            opacity: 0.9;
        }

        .category-name {
            position: absolute; 
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 1rem;
            font-weight: 600;
            font-size: 1.2rem;
            z-index: 2;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            text-align: center; 
        }

        .video-section {
            padding: 3rem 5%;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .video-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            border: 1px solid rgba(138, 43, 226, 0.1);
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 0 2px var(--neon-pink);
        }

        .video-thumb {
            width: 100%;
            padding-top: 56.25%; 
            position: relative; 
            overflow: hidden;
        }

        .video-thumb img {
            position: absolute; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; 
            transition: transform 0.5s;
        }

        .video-card:hover .video-thumb img {
            transform: scale(1.1);
        }

        .video-duration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 2;
        }

        .play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: rgba(160, 32, 240, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 2;
            pointer-events: none;
        }

        .video-card:hover .play-btn {
            opacity: 1;
        }

        .play-btn i {
            color: white;
            font-size: 1.2rem;
        }

        .video-info {
            padding: 1.2rem;
        }

        .video-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 3.2rem;
            line-height: 1.4;
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .video-views {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .video-likes {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--neon-pink);
        }

        footer {
            background: var(--darker-bg);
            padding: 2rem 5%;
            text-align: center;
            margin-top: 3rem;
            border-top: 1px solid rgba(138, 43, 226, 0.1);
        }

        .footer-logo {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text);
            text-shadow:
                0 0 10px var(--neon-pink),
                0 0 20px var(--neon-pink);
        }

        .copyright {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }

        .disclaimer {
            background: rgba(255, 87, 34, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.85rem;
        }

        @media (max-width: 1024px) {
            .video-grid, .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 1.8rem;
            }
            
            header {
                padding: 1rem 3%; 
                gap: 0.8rem;
            }
            
            .tabs {
                justify-content: space-around;
                padding: 1rem 3%; 
            }
            
            .tab {
                padding: 0.7rem 0.5rem;
                font-size: 0.9rem;
                flex-shrink: 1;
                gap: 0.3rem;
            }

            .tab i {
                font-size: 0.9rem;
            }
            
            .video-grid, .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1.5rem;
            }
            
            .search-input.active {
                width: calc(100% - 40px); 
            }
        }

        @media (max-width: 576px) {
            .logo {
                font-size: 1.5rem;
            }
            
            .header-right {
                gap: 1rem;
            }

            .category-card {
                padding-top: 45%; 
            }
            
            .video-grid, .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .age-gate-content {
                padding: 2rem 1.5rem;
            }
            
            .age-buttons {
                flex-direction: column;
                gap: 1rem;
            }
            
            .age-btn {
                width: 100%;
            }

            .tab {
                font-size: 0.8rem;
                padding: 0.6rem 0.2rem;
                gap: 0.2rem;
            }

            .tab i {
                font-size: 0.8rem;
            }
        }

        .custom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .custom-box {
            background-color: var(--card-bg);
            color: var(--text);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            border: 1px solid var(--neon-pink);
            width: 90%;
            max-width: 400px;
        }

        .custom-box p {
            text-align: center;
            font-size: 1.1rem;
        }

        .custom-box button {
            background-color: var(--neon-pink);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }

        .custom-box button:hover {
            background-color: #d81b60;
        }

        .custom-prompt-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .custom-prompt-buttons button {
            flex: 1;
            padding: 12px;
            border-radius: 5px;
        }

        .custom-prompt-buttons .no-btn {
            background-color: #555;
        }

        .custom-prompt-buttons .no-btn:hover {
            background-color: #777;
        }

        .heart-animation-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 5;
            display: none;
        }

        .animated-heart {
            font-size: 5rem;
            color: var(--neon-pink);
            opacity: 0;
            transform: scale(0);
            filter: drop-shadow(0 0 15px var(--neon-pink));
        }

        .animated-heart.animate-heart {
            animation: heartPopFade 0.7s ease-out forwards;
        }

        @keyframes heartPopFade {
            0% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(1); }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-top-row">
            <div class="logo">
                <a href="admin.html" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-fire"></i> XXX Git
                </a>
                <span class="warning-badge">18+</span>
            </div>
            <div class="profile-container">
                <div class="profile-btn" id="profile-btn">
                    <i class="fas fa-user" id="profile-icon"></i>
                </div>
                <div class="dropdown">
                    <div class="dropdown-item" id="user-display-info" style="display: none;">
                        <i class="fas fa-user-circle"></i>
                        <span id="current-user-name"></span>
                    </div>
                    <div class="dropdown-item" id="google-login">
                        <i class="fab fa-google"></i>
                        <span>Log in with Google</span>
                    </div>
                    <div class="dropdown-item" id="guest-login">
                        <i class="fas fa-user-clock"></i>
                        <span>Log in with Guest Account</span>
                    </div>
                    <div class="dropdown-item" id="logout-button" style="display: none;">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Search videos or categories...">
            <button class="search-btn" id="search-toggle-btn">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </header>

    <div class="tabs">
        <button class="tab active" data-tab="home"><i class="fas fa-home"></i> Home</button>
        <button class="tab" data-tab="categories"><i class="fas fa-tags"></i> Categories</button>
        <button class="tab" data-tab="favourite"><i class="fas fa-heart"></i> Favourite</button>
        <button class="tab" data-tab="premium"><i class="fas fa-crown"></i> Premium</button>
    </div>

    <section class="categories-section" id="categories-content" style="display:none;">
        <h2 class="section-title">Categories</h2>
        <div class="categories-grid" id="dynamic-categories-grid">
            <div class="placeholder-message" id="loading-categories">
                <i class="fas fa-spinner fa-spin" style="font-size: 4rem; color: var(--neon-pink); margin-bottom: 1rem;"></i>
                <h3>Loading Categories...</h3>
                <p>Please wait while we fetch the categories.</p>
            </div>
            <div class="placeholder-message" id="no-categories" style="display:none;">
                <i class="fas fa-tags" style="font-size: 4rem; color: var(--neon-pink); margin-bottom: 1rem;"></i>
                <h3>No categories added yet.</h3>
                <p>Visit the admin panel to add some categories.</p>
            </div>
        </div>
    </section>

    <section class="video-section" id="home-content">
        <h2 class="section-title" id="video-section-title">Latest Videos</h2>
        <div class="video-grid" id="dynamic-video-grid">
            <div class="placeholder-message" id="loading-videos">
                <i class="fas fa-spinner fa-spin" style="font-size: 4rem; color: var(--neon-pink); margin-bottom: 1rem;"></i>
                <h3>Loading Videos...</h3>
                <p>Please wait while we fetch the videos.</p>
            </div>
            <div class="placeholder-message" id="no-videos" style="display:none;">
                <i class="fas fa-video" style="font-size: 4rem; color: var(--neon-pink); margin-bottom: 1rem;"></i>
                <h3>No videos added yet.</h3>
                <p>Visit the admin panel to add some videos.</p>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-logo">XXX GIT</div>
        <p class="copyright">
            Â© 2024 XXX GIT. All rights reserved. <br>
            Disclaimer: This site contains content of a mature nature and is intended for adults 18 years or older. By accessing this site, you are affirming that you are of legal age in your jurisdiction to view such content.
        </p>
        <p class="disclaimer">
            This website is for educational and demonstrative purposes only. All content is fictitious and used for illustrative purposes. No real content is hosted or promoted.
        </p>
    </footer>

    <div id="age-gate-overlay" class="custom-overlay" style="display:none;">
        <div class="custom-box age-gate-content">
            <p>You must be 18 years or older to access this content.</p>
            <div class="custom-prompt-buttons age-buttons">
                <button id="age-confirm-btn" class="age-btn">I am 18 or older</button>
                <button id="age-decline-btn" class="age-btn no-btn">Exit</button>
            </div>
        </div>
    </div>

    <div id="video-modal-overlay" class="custom-overlay" style="display:none;">
        <div class="custom-box" style="max-width: 900px; width: 90%;">
            <h2 id="video-modal-title" style="color: var(--neon-pink); margin-bottom: 15px;"></h2>
            <div class="video-player-container" style="position: relative; width: 100%; padding-bottom: 56.25%; height: 0; background: #000;">
                <iframe id="video-modal-iframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
            </div>
            <p id="video-modal-description" style="color: var(--text-secondary); margin-top: 15px; text-align: center;"></p>
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button id="like-button" style="background-color: #fe2a66; display: flex; align-items: center; gap: 5px;"><i class="fas fa-heart"></i> <span id="like-count">0</span> Likes</button>
                <button id="close-video-modal" style="background-color: #555;">Close</button>
            </div>
        </div>
    </div>

    <div id="search-results-overlay" class="custom-overlay" style="display:none;">
        <div class="custom-box" style="max-width: 900px; width: 90%;">
            <h2 style="color: var(--neon-pink); margin-bottom: 15px;">Search Results</h2>
            <div id="search-results-content" style="width: 100%;">
                <div id="search-video-results" class="video-grid" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));"></div>
                <div id="search-category-results" class="categories-grid" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); margin-top: 30px;"></div>
                <p id="no-search-results" style="display:none; text-align: center; color: var(--text-secondary); margin-top: 20px;">No results found.</p>
            </div>
            <button id="close-search-results" style="background-color: #555; margin-top: 20px;">Close</button>
        </div>
    </div>

    <div class="heart-animation-container" id="heart-animation-container">
        <i class="fas fa-heart animated-heart" id="animated-heart"></i>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, getDoc, updateDoc, arrayUnion, arrayRemove, query, orderBy, where } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const ageGateOverlay = document.getElementById('age-gate-overlay');
        const ageConfirmBtn = document.getElementById('age-confirm-btn');
        const ageDeclineBtn = document.getElementById('age-decline-btn');
        const videoModalOverlay = document.getElementById('video-modal-overlay');
        const videoModalTitle = document.getElementById('video-modal-title');
        const videoModalIframe = document.getElementById('video-modal-iframe');
        const videoModalDescription = document.getElementById('video-modal-description');
        const closeVideoModalBtn = document.getElementById('close-video-modal');
        const likeButton = document.getElementById('like-button');
        const likeCountSpan = document.getElementById('like-count');
        const heartAnimationContainer = document.getElementById('heart-animation-container');
        const animatedHeart = document.getElementById('animated-heart');

        const categoriesContent = document.getElementById('categories-content');
        const homeContent = document.getElementById('home-content');
        const dynamicCategoriesGrid = document.getElementById('dynamic-categories-grid');
        const dynamicVideoGrid = document.getElementById('dynamic-video-grid');
        const loadingCategories = document.getElementById('loading-categories');
        const noCategories = document.getElementById('no-categories');
        const loadingVideos = document.getElementById('loading-videos');
        const noVideos = document.getElementById('no-videos');

        const searchInput = document.getElementById('search-input');
        const searchToggleBtn = document.getElementById('search-toggle-btn');
        const searchResultsOverlay = document.getElementById('search-results-overlay');
        const searchVideoResults = document.getElementById('search-video-results');
        const searchCategoryResults = document.getElementById('search-category-results');
        const noSearchResults = document.getElementById('no-search-results');
        const closeSearchResultsBtn = document.getElementById('close-search-results');

        let currentPlayingVideoId = null; 

        // Age Gate Logic
        const hasConfirmedAge = localStorage.getItem('ageConfirmed');

        if (!hasConfirmedAge) {
            ageGateOverlay.style.display = 'flex';
        } else {
            initializeContent();
        }

        ageConfirmBtn.addEventListener('click', () => {
            localStorage.setItem('ageConfirmed', 'true');
            ageGateOverlay.style.display = 'none';
            initializeContent();
        });

        ageDeclineBtn.addEventListener('click', () => {
            window.location.href = "about:blank"; // Redirects to a blank page
        });

        function initializeContent() {
            // Initial content loading
            fetchCategories();
            fetchVideos();
        }

        async function fetchCategories() {
            loadingCategories.style.display = 'flex';
            noCategories.style.display = 'none';
            dynamicCategoriesGrid.innerHTML = ''; 

            try {
                // Modified query to order by isPinned (true first)
                const q = query(collection(db, 'categories'), orderBy('isPinned', 'desc'), orderBy('name', 'asc'));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    loadingCategories.style.display = 'none';
                    noCategories.style.display = 'flex';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const category = doc.data();
                    const categoryCard = document.createElement('div');
                    categoryCard.classList.add('category-card');
                    categoryCard.innerHTML = `
                        <img src="${category.imageUrl || 'https://via.placeholder.com/250x150?text=No+Image'}" alt="${category.name}" class="category-image">
                        <div class="category-name">${category.name}</div>
                    `;
                    categoryCard.addEventListener('click', () => {
                        filterVideosByCategory(category.name);
                    });
                    dynamicCategoriesGrid.appendChild(categoryCard);
                });
                loadingCategories.style.display = 'none';
            } catch (error) {
                console.error("Error fetching categories: ", error);
                loadingCategories.style.display = 'none';
                noCategories.style.display = 'flex';
                noCategories.querySelector('h3').textContent = 'Error loading categories.';
                noCategories.querySelector('p').textContent = 'Please try again later.';
            }
        }

        async function fetchVideos(category = null) {
            loadingVideos.style.display = 'flex';
            noVideos.style.display = 'none';
            dynamicVideoGrid.innerHTML = ''; 
            document.getElementById('video-section-title').textContent = category ? `${category} Videos` : 'Latest Videos';

            try {
                let q;
                if (category) {
                    q = query(collection(db, 'videos'), where('category', '==', category), orderBy('isPinned', 'desc'), orderBy('timestamp', 'desc'));
                } else {
                    // Modified query to order by isPinned (true first) then by timestamp
                    q = query(collection(db, 'videos'), orderBy('isPinned', 'desc'), orderBy('timestamp', 'desc'));
                }
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    loadingVideos.style.display = 'none';
                    noVideos.style.display = 'flex';
                    noVideos.querySelector('h3').textContent = category ? `No videos found in ${category} category.` : 'No videos added yet.';
                    noVideos.querySelector('p').textContent = category ? 'Please check back later or select another category.' : 'Visit the admin panel to add some videos.';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const video = doc.data();
                    const videoId = doc.id;
                    const videoCard = document.createElement('div');
                    videoCard.classList.add('video-card');
                    videoCard.innerHTML = `
                        <div class="video-thumb">
                            <img src="${video.thumbnailUrl}" alt="${video.title}">
                            <span class="video-duration">${video.duration}</span>
                            <div class="play-btn"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="video-info">
                            <h3>${video.title}</h3>
                            <div class="video-meta">
                                <span class="video-views"><i class="fas fa-eye"></i> ${video.views || 0}</span>
                                <span class="video-likes"><i class="fas fa-heart"></i> ${video.likes || 0}</span>
                            </div>
                        </div>
                    `;
                    videoCard.addEventListener('click', () => {
                        openVideoModal(videoId, video);
                    });
                    dynamicVideoGrid.appendChild(videoCard);
                });
                loadingVideos.style.display = 'none';
            } catch (error) {
                console.error("Error fetching videos: ", error);
                loadingVideos.style.display = 'none';
                noVideos.style.display = 'flex';
                noVideos.querySelector('h3').textContent = 'Error loading videos.';
                noVideos.querySelector('p').textContent = 'Please try again later.';
            }
        }

        async function openVideoModal(videoId, videoData) {
            currentPlayingVideoId = videoId;
            videoModalTitle.textContent = videoData.title;
            videoModalIframe.src = videoData.videoUrl; 
            videoModalDescription.textContent = videoData.description || 'No description available.';
            likeCountSpan.textContent = videoData.likes || 0; 
            videoModalOverlay.style.display = 'flex';

            // Check if user has liked this video
            const user = auth.currentUser;
            if (user && !user.isAnonymous) {
                const userDocRef = doc(db, 'users', user.uid);
                const userDocSnap = await getDoc(userDocRef);
                if (userDocSnap.exists() && userDocSnap.data().favorites && userDocSnap.data().favorites.includes(videoId)) {
                    likeButton.classList.add('liked');
                } else {
                    likeButton.classList.remove('liked');
                }
            } else {
                likeButton.classList.remove('liked');
            }

            // Update video views
            const videoRef = doc(db, 'videos', videoId);
            await updateDoc(videoRef, {
                views: (videoData.views || 0) + 1
            });
            // Re-fetch videos to update view count on display, or just update the displayed count directly if preferred
            // fetchVideos(); 
        }

        closeVideoModalBtn.addEventListener('click', () => {
            videoModalOverlay.style.display = 'none';
            videoModalIframe.src = ''; 
            currentPlayingVideoId = null;
        });

        likeButton.addEventListener('click', async () => {
            const user = auth.currentUser;
            if (!user) {
                alert('Please log in to like videos.');
                return;
            }

            if (user.isAnonymous) {
                alert('Guest users cannot like videos. Please log in with Google.');
                return;
            }

            if (currentPlayingVideoId) {
                const videoRef = doc(db, 'videos', currentPlayingVideoId);
                const userDocRef = doc(db, 'users', user.uid);

                try {
                    const videoDoc = await getDoc(videoRef);
                    if (!videoDoc.exists()) {
                        console.error("Video document not found!");
                        return;
                    }

                    const videoData = videoDoc.data();
                    let currentLikes = videoData.likes || 0;

                    const userDoc = await getDoc(userDocRef);
                    let userFavorites = userDoc.exists() ? (userDoc.data().favorites || []) : [];

                    if (userFavorites.includes(currentPlayingVideoId)) {
                        // Unlike
                        await updateDoc(videoRef, { likes: currentLikes - 1 });
                        await updateDoc(userDocRef, { favorites: arrayRemove(currentPlayingVideoId) });
                        likeButton.classList.remove('liked');
                        likeCountSpan.textContent = currentLikes - 1;
                        console.log("Video unliked!");
                    } else {
                        // Like
                        await updateDoc(videoRef, { likes: currentLikes + 1 });
                        await updateDoc(userDocRef, { favorites: arrayUnion(currentPlayingVideoId) });
                        likeButton.classList.add('liked');
                        likeCountSpan.textContent = currentLikes + 1;
                        triggerHeartAnimation();
                        console.log("Video liked!");
                    }
                    // Re-fetch videos for home/category if needed to reflect updated like counts immediately
                    // fetchVideos(); 
                } catch (error) {
                    console.error("Error updating like status:", error);
                }
            }
        });

        function triggerHeartAnimation() {
            heartAnimationContainer.style.display = 'flex';
            animatedHeart.classList.remove('animate-heart'); // Reset animation
            void animatedHeart.offsetWidth; // Trigger reflow
            animatedHeart.classList.add('animate-heart');
            setTimeout(() => {
                heartAnimationContainer.style.display = 'none';
            }, 700); 
        }

        // Tab switching logic
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                const targetTab = this.dataset.tab;

                homeContent.style.display = 'none';
                categoriesContent.style.display = 'none';
                // Add more content sections as needed for other tabs

                if (targetTab === 'home') {
                    homeContent.style.display = 'block';
                    fetchVideos(); // Reload all videos for home
                } else if (targetTab === 'categories') {
                    categoriesContent.style.display = 'block';
                    fetchCategories(); // Reload categories
                } else if (targetTab === 'favourite') {
                    homeContent.style.display = 'block'; // Display favourites in video grid area
                    const user = auth.currentUser;
                    if (user) {
                        fetchUserFavorites(user.uid);
                    } else {
                        displayNoFavoritesMessage("Please log in to see your favourites.");
                    }
                } else if (targetTab === 'premium') {
                     homeContent.style.display = 'block'; // Display premium videos in video grid area
                     fetchPremiumVideos();
                }
            });
        });

        // Search functionality
        searchToggleBtn.addEventListener('click', () => {
            searchInput.classList.toggle('active');
            if (searchInput.classList.contains('active')) {
                searchInput.focus();
            } else {
                searchInput.value = ''; // Clear search on collapse
                if (searchResultsOverlay.style.display === 'flex') {
                    searchResultsOverlay.style.display = 'none';
                    fetchVideos(); // Reload all videos when search is closed
                    fetchCategories(); // Reload all categories
                }
            }
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch(searchInput.value);
            }
        });

        async function performSearch(searchTerm) {
            searchTerm = searchTerm.toLowerCase().trim();
            if (!searchTerm) {
                alert('Please enter a search term.');
                return;
            }

            searchResultsOverlay.style.display = 'flex';
            searchVideoResults.innerHTML = '';
            searchCategoryResults.innerHTML = '';
            noSearchResults.style.display = 'none';

            let videosFound = 0;
            let categoriesFound = 0;

            // Search videos
            try {
                const videosQuery = query(collection(db, 'videos'), 
                    orderBy('title'), 
                    orderBy('views', 'desc') // Example secondary order
                );
                const videoSnapshot = await getDocs(videosQuery);
                videoSnapshot.forEach((doc) => {
                    const video = doc.data();
                    const videoId = doc.id;
                    if (video.title.toLowerCase().includes(searchTerm) || video.description.toLowerCase().includes(searchTerm) || video.category.toLowerCase().includes(searchTerm)) {
                        const videoCard = document.createElement('div');
                        videoCard.classList.add('video-card');
                        videoCard.innerHTML = `
                            <div class="video-thumb">
                                <img src="${video.thumbnailUrl}" alt="${video.title}">
                                <span class="video-duration">${video.duration}</span>
                                <div class="play-btn"><i class="fas fa-play"></i></div>
                            </div>
                            <div class="video-info">
                                <h3>${video.title}</h3>
                                <div class="video-meta">
                                    <span class="video-views"><i class="fas fa-eye"></i> ${video.views || 0}</span>
                                    <span class="video-likes"><i class="fas fa-heart"></i> ${video.likes || 0}</span>
                                </div>
                            </div>
                        `;
                        videoCard.addEventListener('click', () => {
                            openVideoModal(videoId, video);
                        });
                        searchVideoResults.appendChild(videoCard);
                        videosFound++;
                    }
                });
            } catch (error) {
                console.error("Error searching videos:", error);
            }

            // Search categories
            try {
                const categoriesQuery = query(collection(db, 'categories'), orderBy('name'));
                const categorySnapshot = await getDocs(categoriesQuery);
                categorySnapshot.forEach((doc) => {
                    const category = doc.data();
                    if (category.name.toLowerCase().includes(searchTerm)) {
                        const categoryCard = document.createElement('div');
                        categoryCard.classList.add('category-card');
                        categoryCard.innerHTML = `
                            <img src="${category.imageUrl || 'https://via.placeholder.com/250x150?text=No+Image'}" alt="${category.name}" class="category-image">
                            <div class="category-name">${category.name}</div>
                        `;
                        categoryCard.addEventListener('click', () => {
                            filterVideosByCategory(category.name);
                            searchResultsOverlay.style.display = 'none'; // Close search results after filtering
                            // Also switch to home tab if on categories tab
                            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                            document.querySelector('.tab[data-tab="home"]').classList.add('active');
                        });
                        searchCategoryResults.appendChild(categoryCard);
                        categoriesFound++;
                    }
                });
            } catch (error) {
                console.error("Error searching categories:", error);
            }

            if (videosFound === 0 && categoriesFound === 0) {
                noSearchResults.style.display = 'block';
            }
        }

        closeSearchResultsBtn.addEventListener('click', () => {
            searchResultsOverlay.style.display = 'none';
            searchInput.value = '';
            searchInput.classList.remove('active');
            fetchVideos(); // Refresh home videos when closing search
            fetchCategories(); // Refresh categories when closing search
        });

        function filterVideosByCategory(categoryName) {
            fetchVideos(categoryName);
            // Switch to home tab and hide categories section
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="home"]').classList.add('active');
            categoriesContent.style.display = 'none';
            homeContent.style.display = 'block';
        }

        async function fetchUserFavorites(uid) {
            loadingVideos.style.display = 'flex';
            noVideos.style.display = 'none';
            dynamicVideoGrid.innerHTML = '';
            document.getElementById('video-section-title').textContent = 'Your Favourites';

            try {
                const userDocRef = doc(db, 'users', uid);
                const userDocSnap = await getDoc(userDocRef);

                if (!userDocSnap.exists() || !userDocSnap.data().favorites || userDocSnap.data().favorites.length === 0) {
                    displayNoFavoritesMessage("You haven't favourited any videos yet.");
                    return;
                }

                const favoriteVideoIds = userDocSnap.data().favorites;
                const favoriteVideos = [];

                // Fetch each favorite video by ID
                for (const videoId of favoriteVideoIds) {
                    const videoRef = doc(db, 'videos', videoId);
                    const videoSnap = await getDoc(videoRef);
                    if (videoSnap.exists()) {
                        favoriteVideos.push({ id: videoSnap.id, ...videoSnap.data() });
                    }
                }
                
                // Sort favorite videos to show pinned first
                favoriteVideos.sort((a, b) => (b.isPinned || false) - (a.isPinned || false));


                if (favoriteVideos.length === 0) {
                    displayNoFavoritesMessage("You haven't favourited any videos yet.");
                    return;
                }

                favoriteVideos.forEach((video) => {
                    const videoCard = document.createElement('div');
                    videoCard.classList.add('video-card');
                    videoCard.innerHTML = `
                        <div class="video-thumb">
                            <img src="${video.thumbnailUrl}" alt="${video.title}">
                            <span class="video-duration">${video.duration}</span>
                            <div class="play-btn"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="video-info">
                            <h3>${video.title}</h3>
                            <div class="video-meta">
                                <span class="video-views"><i class="fas fa-eye"></i> ${video.views || 0}</span>
                                <span class="video-likes"><i class="fas fa-heart"></i> ${video.likes || 0}</span>
                            </div>
                        </div>
                    `;
                    videoCard.addEventListener('click', () => {
                        openVideoModal(video.id, video);
                    });
                    dynamicVideoGrid.appendChild(videoCard);
                });
                loadingVideos.style.display = 'none';
            } catch (error) {
                console.error("Error fetching user favorites:", error);
                displayNoFavoritesMessage("Error loading favourites. Please try again.");
            }
        }

        function displayNoFavoritesMessage(message) {
            loadingVideos.style.display = 'none';
            noVideos.style.display = 'flex';
            noVideos.querySelector('h3').textContent = message;
            noVideos.querySelector('p').textContent = ''; // Clear sub-message
            dynamicVideoGrid.innerHTML = ''; // Ensure grid is empty
        }

        async function fetchPremiumVideos() {
            loadingVideos.style.display = 'flex';
            noVideos.style.display = 'none';
            dynamicVideoGrid.innerHTML = '';
            document.getElementById('video-section-title').textContent = 'Premium Videos';

            try {
                // Fetch videos where isPremium is true, sorted by isPinned then timestamp
                const q = query(collection(db, 'videos'), where('isPremium', '==', true), orderBy('isPinned', 'desc'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    loadingVideos.style.display = 'none';
                    noVideos.style.display = 'flex';
                    noVideos.querySelector('h3').textContent = 'No premium videos available yet.';
                    noVideos.querySelector('p').textContent = 'Check back later for exclusive content!';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const video = doc.data();
                    const videoId = doc.id;
                    const videoCard = document.createElement('div');
                    videoCard.classList.add('video-card');
                    videoCard.innerHTML = `
                        <div class="video-thumb">
                            <img src="${video.thumbnailUrl}" alt="${video.title}">
                            <span class="video-duration">${video.duration}</span>
                            <div class="play-btn"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="video-info">
                            <h3>${video.title}</h3>
                            <div class="video-meta">
                                <span class="video-views"><i class="fas fa-eye"></i> ${video.views || 0}</span>
                                <span class="video-likes"><i class="fas fa-heart"></i> ${video.likes || 0}</span>
                            </div>
                        </div>
                    `;
                    videoCard.addEventListener('click', () => {
                        openVideoModal(videoId, video);
                    });
                    dynamicVideoGrid.appendChild(videoCard);
                });
                loadingVideos.style.display = 'none';
            } catch (error) {
                console.error("Error fetching premium videos: ", error);
                loadingVideos.style.display = 'none';
                noVideos.style.display = 'flex';
                noVideos.querySelector('h3').textContent = 'Error loading premium videos.';
                noVideos.querySelector('p').textContent = 'Please try again later.';
            }
        }


        // Profile dropdown logic
        const profileBtn = document.getElementById('profile-btn');
        const dropdown = document.querySelector('.dropdown');
        const googleLoginBtn = document.getElementById('google-login');
        const guestLoginBtn = document.getElementById('guest-login');
        const logoutBtn = document.getElementById('logout-button');
        const currentUserNameSpan = document.getElementById('current-user-name');
        const userDisplayInfo = document.getElementById('user-display-info');
        const profileIconElement = document.getElementById('profile-icon');
        const profileBtnElement = document.getElementById('profile-btn');

        profileBtn.addEventListener('click', () => {
            dropdown.classList.toggle('active');
        });

        // Close dropdown if clicked outside
        window.addEventListener('click', (e) => {
            if (!profileBtn.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });

        googleLoginBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                dropdown.classList.remove('active');
            } catch (error) {
                console.error("Google Sign-in Error:", error);
                alert("Failed to sign in with Google: " + error.message);
            }
        });

        guestLoginBtn.addEventListener('click', async () => {
            try {
                await signInAnonymously(auth);
                dropdown.classList.remove('active');
            } catch (error) {
                console.error("Guest Sign-in Error:", error);
                alert("Failed to sign in as guest: " + error.message);
            }
        });

        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                dropdown.classList.remove('active');
                console.log("User signed out.");
            } catch (error) {
                console.error("Logout Error:", error);
                alert("Failed to log out: " + error.message);
            }
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User is signed in:", user.uid);
                if (user.photoURL) {
                    profileBtnElement.style.backgroundImage = `url(${user.photoURL})`;
                    profileIconElement.style.display = 'none';
                } else {
                    profileBtnElement.style.backgroundImage = 'none';
                    profileIconElement.style.display = 'block';
                }

                if (user.isAnonymous) {
                    currentUserNameSpan.textContent = `Guest User (${user.uid.substring(0, 8)}...)`;
                    googleLoginBtn.style.display = 'flex';
                    guestLoginBtn.style.display = 'none';
                } else {
                    currentUserNameSpan.textContent = user.displayName || user.email;
                    googleLoginBtn.style.display = 'none';
                    guestLoginBtn.style.display = 'none';
                }
                userDisplayInfo.style.display = 'flex';
                logoutBtn.style.display = 'flex';
                
                if (document.querySelector('.tab[data-tab="favourite"]').classList.contains('active')) {
                    fetchUserFavorites(user.uid);
                }
            } else {
                console.log("User is signed out.");

                profileBtnElement.style.backgroundImage = 'none';
                profileIconElement.style.display = 'block';
                currentUserNameSpan.textContent = '';
                userDisplayInfo.style.display = 'none';

                googleLoginBtn.style.display = 'flex';
                guestLoginBtn.style.display = 'flex';
                logoutBtn.style.display = 'none';
                
                if (document.querySelector('.tab[data-tab="favourite"]').classList.contains('active')) {
                    displayNoFavoritesMessage("Please log in to see your favourites.");
                }
            }
        });

    </script>
</body>
</html>
